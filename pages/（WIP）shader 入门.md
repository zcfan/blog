- > å‘¨ä¼šåˆ†äº«å†…å®¹ï¼Œæ•´ç†ä¸€ä¸‹æ°´ä¸€ç¯‡
- è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬é€šè¿‡å‡ ä¸ª demo å¯¹ shader æœ‰ä¸ªç›´è§‚çš„äº†è§£ã€‚
- # demo é¢„è§ˆ
- ## demo1ï¼švertex ä»¥åŠ vertex shaderï¼ˆé¡¶ç‚¹ç€è‰²å™¨ï¼‰
- ![preview1.gif](../assets/preview1_1706180285397_0.gif)
- https://github.com/zcfan/babylonjs-demo-shader-material
- ## demo2ï¼šfragment shaderï¼ˆç‰‡å…ƒç€è‰²å™¨ï¼‰ ä»¥åŠå‡¸çƒæ•ˆæœï¼ˆçèµ·çš„åå­—ï¼‰
- ![preview2.gif](../assets/preview2_1706180361884_0.gif)
- [https://www.shadertoy.com/view/McBXzm](https://www.shadertoy.com/view/McBXzm)
- ## demo3ï¼šè¿˜æ˜¯ fragment shaderï¼Œåƒç´ é£ç€è‰²å™¨
- ![preview3.gif](../assets/preview3_1706180395114_0.gif)
- [https://www.shadertoy.com/view/lcBXzm](https://www.shadertoy.com/view/lcBXzm)
- # å‰è¨€
- æˆ‘ä»¬çš„ demo1 æ˜¯ç”¨ babylonjs å®ç°çš„ç®€å•åœºæ™¯ï¼Œdemo2ã€3 ä½¿ç”¨ shadertoy ç¼–å†™ã€‚
- babylonjs å¾ˆå¤šåŒå­¦éƒ½äº†è§£è¿‡ï¼Œæ˜¯ä¸€ä¸ª 3d æ¸²æŸ“å¼•æ“ï¼Œshadertoy å¯èƒ½å°±æœ‰äº›é™Œç”Ÿäº†ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªæ¡†æ¶/å¼•æ“ï¼Œè€Œæ˜¯ä¸€ä¸ªç¼–å†™ã€åˆ†äº« shaderï¼ˆfragment shaderï¼‰çš„å¹³å°ã€‚
- ![image.png](../assets/image_1706181039252_0.png)
- ä»¥æˆ‘ä»¬çš„ demo3 ä¸ºä¾‹ï¼Œæˆ‘ä»¬å…³æ³¨è¿™ 4 ä¸ªåŒºåŸŸï¼š
- æˆ‘ä»¬çš„ç€è‰²å™¨æœ€ç»ˆçš„æ¸²æŸ“ç»“æœ
  logseq.order-list-type:: number
- ç€è‰²å™¨å¯ç”¨çš„æ‰€æœ‰è¾“å…¥ï¼Œæˆ‘ä»¬ç”¨åˆ°äº† iChannel0ï¼ˆä»è§†é¢‘ç”»é¢ä¸­é‡‡æ ·é¢œè‰²ï¼‰ã€iResolutionï¼ˆè®¡ç®— uv åæ ‡ï¼‰ã€iMouseï¼ˆä¸é¼ æ ‡åæ ‡äº’åŠ¨ï¼‰
  logseq.order-list-type:: number
- ç€è‰²å™¨çš„ä»£ç åŒºåŸŸ
  logseq.order-list-type:: number
- æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè§†é¢‘ä½œä¸ºçº¹ç†ï¼Œä¹Ÿå¯ä»¥æ˜¯å›¾ç‰‡ç­‰å…¶ä»– 2d åŸææ–™
  logseq.order-list-type:: number
- webgl ç€è‰²å™¨ä½¿ç”¨çš„æ˜¯ glsl è¯­è¨€ç¼–å†™ï¼Œå’Œ c å¾ˆåƒå­¦èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼ˆéš¾çš„æ˜¯ç†è®ºçŸ¥è¯†ğŸ˜‚ï¼‰ï¼Œè€Œä¸”æˆ‘ä»¬è¿™é‡Œæ˜¯ç›´è§‚ä»‹ç»ä¸ä¼šæ¶‰åŠå¤ªå¤šå®ç°ç»†èŠ‚ï¼Œæ‰€ä»¥å³ä½¿æ²¡æ¥è§¦è¿‡ä¹Ÿå¯ä»¥æ¥ç€çœ‹çœ‹ï¼Œä»¥åæœ‰éœ€æ±‚äº†å¯ä»¥è”æƒ³åˆ°è¿™é‡Œã€‚
- # Demo1 é¡¶ç‚¹ç€è‰²å™¨
- ![image.png](../assets/image_1706181527378_0.png)
- è¿™æ˜¯ä¸€ä¸ªä¸‰ç»´ç©ºé—´ä¸­çš„å¹³é¢ï¼Œç¨å¾®äº†è§£è¿‡å›¾å½¢å­¦çš„åŒå­¦åº”è¯¥çŸ¥é“ï¼Œæˆ‘ä»¬åœ¨ç”µè„‘ä¸Šçœ‹åˆ°çš„ 3d ç”»é¢ï¼Œéƒ½æ˜¯ç”±ä¸€ä¸ªä¸ªä¸‰è§’å½¢ç»„æˆçš„ã€‚è¿™ä¸ªå¹³é¢ä¹Ÿä¸ä¾‹å¤–ï¼Œå®ƒæ˜¯ç”±ä¸¤ä¸ªä¸‰è§’å½¢æ‹¼åœ¨ä¸€èµ·å½¢æˆçš„ï¼š
- ![image.png](../assets/image_1706181511478_0.png)
- webgl æœ¬è´¨ä¸Šåªæ˜¯ä¸€ä¸ªå…‰æ …åŒ–å¼•æ“ï¼Œå®ƒçš„å·¥ä½œæµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦æœ‰ä¸¤ä¸ªç‚¹å¯ä»¥è‡ªå·±æ§åˆ¶ï¼šé¡¶ç‚¹ç€è‰²å™¨ã€ç‰‡å…ƒç€è‰²å™¨ã€‚
- ä¸¤ä¸ªä¸‰è§’å½¢å…±æœ‰å…­ä¸ªç‚¹ï¼Œæˆ‘ä»¬ç®¡å®ƒä»¬å«åšé¡¶ç‚¹ã€‚
- ä¸‰è§’å½¢å›´å‡ºæ¥çš„ç©ºé—´è¢«åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªç‚¹ï¼Œè¿™äº›ç‚¹å±•ç¤ºçš„é¢œè‰²å±•ç¤ºåœ¨ä¸€èµ·ï¼Œå°±å½¢æˆäº†æˆ‘ä»¬çš„æœ€ç»ˆçœ‹åˆ°çš„ç”»é¢ã€‚ä¸ºæ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè®¤ä¸ºå®ƒä»¬æ˜¯åƒç´ ã€‚ä½†æ³¨æ„è¿™å¹¶ä¸ä¸¥è°¨ï¼Œå¦‚æœæœ‰æ›´å¤šéœ€æ±‚ï¼Œå¯ä»¥å‚è€ƒå…¶ä»–ä¸“ä¸šçš„å­¦ä¹ ææ–™ã€‚
- é¡¶ç‚¹ç€è‰²å™¨çš„ä½œç”¨ï¼Œæ˜¯å°† 3d ç©ºé—´ä¸­çš„é¡¶ç‚¹åæ ‡ï¼Œè½¬æ¢åˆ°è£å‰ªç©ºé—´åæ ‡ã€‚æˆ‘ä»¬çš„ä¾‹å­ä¸­ä¸ç”¨ç†è§£è¿™ä¸ªï¼Œä¿æŒé»˜è®¤çš„ç®—æ³•ï¼Œæœ€ç»ˆç”»é¢å°±èƒ½å¾—åˆ°è¿‘å¤§è¿œå°é€è§†å…³ç³»ã€‚ä½†æˆ‘ä»¬ä¼šæ¼”ç¤ºå¦‚ä½•åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ï¼Œè°ƒæ•´é¡¶ç‚¹åæ ‡çš„ y å€¼ï¼Œå®ç°å‰é¢é¢„è§ˆå›¾ä¸­çš„å¸ƒæ–™é£˜åŠ¨æ•ˆæœã€‚
- ç‰‡å…ƒç€è‰²å™¨çš„ä½œç”¨ï¼Œæ˜¯å†³å®šæ¯ä¸€ä¸ªç‰‡å…ƒï¼ˆå¯ä»¥å…ˆç†è§£æˆåƒç´ ï¼‰çš„é¢œè‰²ã€‚ç›¸å½“äºåœ¨é¡¶ç‚¹å›´å‡ºçš„åŒºåŸŸå†…ç”¨é¢œæ–™ç”»ç”»ã€‚ç‰¹åˆ«ä¹‹å¤„åœ¨äºï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ç€è‰²å™¨ä»£ç ï¼Œä¸€ä¸ªç‚¹ä¸€ä¸ªç‚¹çš„å¡«å……é¢œè‰²ã€‚è€Œä¹‹æ‰€ä»¥ GPU æ¸²æŸ“é€Ÿåº¦å¿«ï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ªè¿‡ç¨‹æ˜¯å¹¶è¡Œçš„ã€‚
- å¦‚æœæ˜¯ CPU æ¥æ¸²æŸ“ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªç‚¹æ¥ï¼Œæœ€ç»ˆè€—æ—¶æ˜¯ `1+1+...+1=n`ï¼Œå°±åƒè¿™æ ·ï¼š
- {{video https://youtu.be/ZrJeYFxpUyQ?t=173}}
- è€Œ GPU å¯ä»¥å¹¶è¡Œï¼Œæ‰€æœ‰ç‚¹ä¸€èµ·è¿›è¡Œæ¸²æŸ“ï¼Œæœ€ç»ˆè€—æ—¶æ˜¯ `max(1,1,...,1)=1`ï¼Œå°±åƒè¿™æ ·ï¼š
- {{video https://youtu.be/ZrJeYFxpUyQ?t=493}}
- è·‘çš„æœ‰ç‚¹åäº†æ”¶ä¸€ä¸‹ï¼Œè¿™ç« çš„ä¸»é¢˜æ˜¯é¡¶ç‚¹ç€è‰²å™¨ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“å®ƒå¤§æ¦‚æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿æœ‰ä»€ä¹ˆç”¨äº†ã€‚æƒ³è¦å®ç° demo1 çš„é£˜åŠ¨æ•ˆæœï¼Œå…¶å®åªéœ€è¦æ“çºµé¡¶ç‚¹çš„ y å€¼ï¼Œè®©é¡¶ç‚¹æŒ‰æŸç§è§„å¾‹ï¼Œéšæ—¶é—´ä¸åœä¸Šä¸‹ç§»åŠ¨å°±å¯ä»¥äº†ã€‚å…³é”®ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·ï¼š
- ```
  void main(void) {
    // position: é¡¶ç‚¹åœ¨ 3 ç»´ç©ºé—´ä¸­çš„åæ ‡ï¼Œxyz
    // vec3: ä¸‰ä¸ª float ç»„æˆçš„å‘é‡ï¼ˆvectorï¼‰
    
    // å¤åˆ¶ä¸€ä»½é¡¶ç‚¹çš„åæ ‡ï¼Œåé¢æˆ‘ä»¬ä¿®æ”¹è¿™ä¸ªå¤åˆ¶å€¼
    vec3 p = position;
    
    // åªéœ€è¦ä¿®æ”¹ y å€¼å³å¯å®ç°åŠ¨ç”»
    // æˆ‘ä»¬æ‹¿é¡¶ç‚¹çš„ x, y åæ ‡ï¼Œä»¥åŠ time ä½œä¸ºå˜é‡ï¼Œé…åˆä¸‰è§’å‡½æ•°å®ç°ä¸€ä¸ªå¾ªç¯å¾€å¤çš„åŠ¨ç”»
    // è¿™é‡Œçš„ç®—æ³•å¹¶ä¸é‡è¦ï¼Œå®é™…ä¸Šæˆ‘ä¹Ÿæ˜¯åªæ˜¯éšæ‰‹çå†™çš„ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±è°ƒæ•´ï¼Œæ„Ÿå—ä¸€ä¸‹ä¸åŒçš„è®¡ç®—å¯¹ç»“æœçš„å½±å“
    p.y = (sin(time + position.x) + cos(time + position.z)) / 2.;
    
    // gl_Positionï¼šè®¡ç®—å‡ºæ¥çš„è£å‰ªç©ºé—´åæ ‡ï¼Œè¦èµ‹å€¼ç»™è¿™ä¸ªå˜é‡ï¼Œä½œä¸ºé¡¶ç‚¹ç€è‰²å™¨çš„è¿ç®—ç»“æœã€‚
    // æ˜¯çš„ï¼Œç»“æœè¦èµ‹å€¼ä¸ªä¸€ä¸ªå˜é‡ï¼Œè€Œä¸æ˜¯ return
    gl_Position = worldViewProjection * vec4(p, 1.0);
    // å‰é¢çš„ worldViewProjection æ˜¯ babylon æ¡†æ¶ä¼ å…¥çš„å˜æ¢çŸ©é˜µï¼Œå®ç°é€è§†ç”»é¢æ‰€å¿…é¡»çš„ä¸œè¥¿
    // ä½†æœ¬æ–‡ä¸­æˆ‘ä»¬å¯ä»¥å¿½ç•¥ï¼Œåªè€ƒè™‘ 3 ç»´ç©ºé—´ä¸­çš„åæ ‡ï¼ˆä¸–ç•Œåæ ‡ï¼‰å³å¯ã€‚
  }
  ```
- ç„¶åå°±å®ç°äº† demo æ•ˆæœï¼ˆä¸ºæ–¹ä¾¿ç†è§£ï¼Œæ¸²æŸ“ä¸ºç½‘æ ¼ï¼‰ï¼š
- ![2024-01-2911.13.34-ezgif.com-video-to-gif-converter.gif](../assets/2024-01-2911.13.34-ezgif.com-video-to-gif-converter_1706498471393_0.gif)
- ç„¶åå¢åŠ ç»†åˆ†æ•°é‡ï¼Œç¨åŠ è°ƒæ•´ä¸€äº›å‚æ•°ï¼Œå°±å¯ä»¥è®©åŠ¨ç”»å˜å¾—å¹³æ»‘æµç•…ï¼š
- ![2024-01-2911.23.54-ezgif.com-video-to-gif-converter.gif](../assets/2024-01-2911.23.54-ezgif.com-video-to-gif-converter_1706498714860_0.gif)
- æœ€ååœ¨ fragment shader ç®€å•å®ç°é¢œè‰²çš„æ¸²æŸ“ï¼Œéšyåæ ‡ä¸åŒè€Œæ”¹å˜é¢œè‰²ï¼š
- ![preview1.gif](../assets/preview1_1706180285397_0.gif)
- fragment shader çš„ä»£ç éå¸¸ç®€å•ï¼š
- ```
  precision highp float;
  
  varying float y;
  
  void main(void) {
    // å‚æ•° y çš„å€¼æ˜¯ vertex shader ä¸­ä¼ è¿›æ¥çš„ã€‚
    // sin/cos çš„å–å€¼èŒƒå›´æ˜¯ [-1, 1]ï¼Œéœ€è¦æŒ‰æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ˜ å°„åˆ°é¢œè‰²å€¼å–å€¼èŒƒå›´ï¼ˆ[0, 1.0]ï¼‰å†…ã€‚
    float r = y / 2. + 0.5;  // [-1, 1] -> [0,   1]
    float g = y / 4. + 0.75; // [-1, 1] -> [0.5, 1]
  
    // vec4(r, g, b, a) ç›¸å½“äº css çš„ rgba()ï¼Œå–å€¼èŒƒå›´ä» [0,255] å˜æˆä¸€ä¸ªæµ®ç‚¹æ•° [0, 1.0]
    // æŠŠé¢œè‰²å€¼èµ‹å€¼ç»™ gl_FragColor å°±ç›¸å½“äºæ˜¯ fragment shader çš„è¿”å›å€¼
    gl_FragColor = vec4(r, g, 1., 1.);
  }
  ```
-